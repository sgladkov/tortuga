# ТЗ

### Краткое описание
Система реализует бизнес-логику фриланс-биржи. Особенностью реализации является стимуляция сотрудничества исполнитеоей, реализованная как возможность создавать подроекты для своих текущих проектов и институт "менторства", позволяющий более опытным исполнителям оказывать помощь менее опытным при выборе проектов и работе над ними в обмен на растянутое во времени вознаграждение с будущих заработков начинающих исполнителей.

### Общие требования
Система представляет собой HTTP API со следующими требованиями к бизнес-логике:


* регистрация, аутентификация и авторизация пользователей;
* создание новых проектов (в том числе подпроектов существующих проектов), выбор исполнителей для своих проектов, приемка или отклонение решения проекта;
* выставление заявок на выполнение проектов, отправка решений проектов, отказ от проекта;
* учёт и ведение списка текущих проектов зарегистрированного пользователя;
* учёт и ведение счёта зарегистрированного пользователя, его пополнение и вывод;


### Абстрактные схемы взаимодействия с системой

##### 1. Пользователь-заказчик:

* Пользователь регистрируется на бирже.
* Пользователь создает проект с описанием.
* После появления заявок от исполнителей заказчик выбирает одного из них. По каждому исполнителю можно посмотреть его рейтинг и историю работ. При этом на счету пользователя блокируется сумма, о которой он договорился с исполнителем. Если денег на счету не достаточно - проект переходит в Pending состояние до пополнения счета. 
* После того как исполнитель предложит решение, принять или отклонить его. При принятии решения заблокированная на счету заказчика сумма отправится исполнителю.
* Заказчик может закрыть проект при отсутствии принятого решения по истечении времени, указаного при создании проекта, но не обязан этого делать.
* После окончания проекта заказчик выставляет оценку исполнителю.
* При наличии положительного остатка на счету заказчик может вывесчти его.


##### 2. Пользователь-исполнитель:

* Пользователь регистрируется на бирже.
* Пользователь смотрит текущий список активных заказов. По каждому заказчику доступен его рейтинг как заказчика и история заказов.
* Пользователь посылает заявку на исполнение выбраного проекта. 
* После того как заказчик одобрил заявку, а проект перешел в Working состояние (сумма оплаты заблокировалась на счету заказчика), пользователь приступает к выполнению. Он в любой момент может отправить решение или отказаться от заказа.
* После окончания проекта исполнитель выставляет оценку заказчику.
* При наличии положительного остатка на счету исполнитель может вывести его.


##### 3. Подпроекты:

* Если у исполнителя есть активный проект в работе, он может выделить его часть как подпроект и отдать его на исполнение другому исполнителю. Сумма оплаты по всем подпроектам проекта должна быть меньше суммы оплаты проекта. 
* Исполнитель родительского проекта не может послать заказчику решение пока остаются открытые подпроекты.
* При начислении оплаты за родительский проект из нее автоматически производится оплата за все его подпроекты.
* В подпроекте в свою очередь тоже можно создать подпроекты с произвольным уровнем сложности. 
* В остальных отношениях подпроект идентичен простому проекту.


##### 4. Менторство:

* Более опытный исполнитель может выступать ментором менее опытного (далее - студента): он оказывает ему неформализованую помощь при работе над проектоами, получая долю от вознаграждения в этих проектах и в некотором количестве будущих проектов, выполненых студентом. В люблое время все могут проверить рейтинг любого пользователя как ментора или студента и историю его менторства и студенчества.
* Заказчик видит менторов исполнителя при заявке на выполнение заказа и может учесть влияние ментора на надежность работы данного исполнителя.
* Любой пользователь может отправить запрос на менторство любому пользователю, который может принять его или отклонить.
* При принятии запроса ментор будет помогать студенту в течение 5 следующих проектов и будет получать 5% оплаты с его следующих 50 проектов (в будущем можно сделать эти значения изменяемыми). 
* По окончании 5 проектов ментор и студент оценивают друг друга.



### Сводное HTTP API
API состоит из двух частей - публичного (доступного всем без авторизации) и приватного, доступного только зарегистрированным пользователям

##### Публичное API
GET /api/public/user_list - получение списка пользователей с возможностью сортировки и фильтрации

GET /api/public/user/{id} - получение информации о данном пользователе

GET /api/public/user/{id}/history - получение истории данного пользователя (участие в проектах и менторстве) с возможностью фильтрации и сортировки

POST /api/public/register - регистрация нового пользователя

GET /api/public/project_list - получение списка проектов с возможностью сортировки и фильтрации

GET /api/public/project/{id}- получение информации о данном проекте

	
##### Авторизация
Аутентификация и авторизация пользователя выполняется на основе его криптовалютного кошелька, т.е. при регистрации пользователя происходит регистрация его адреса (= хеш публичного ключа), запросы, тре6ующие авторизации, подписываются приватным ключем этого пользователя на клиенте (ECDSA подпись),  подпись передается в заголовке запрооса, сервер восстанавливает из подписи публичный ключ пользователя и сравнивакет его хеш с зарегистрированным адресом пользователя.  Для предотвращения replay атак к подписываемым данным добавляется время запроса, и сервер проверяет его актуальность (?) 

##### Приватное API

 POST /api/private/create_project - создание проекта



### Общие ограничения и требования
* хранилище данных — PostgreSQL;
* клиент может поддерживать HTTP-запросы/ответы со сжатием данных;
* клиент не обязан делать запросы соответственно нижеизложенной спецификации API, любая проверка запроса остаётся на усмотрение студента;
* Для работы со счетами пользователей используется Ethereum-like криптовалюта, конкретная сеть задается в настройках
* В прототипе используеться самая простая схема расчетов: у биржи есть адрес, каждому пользователю при регистрации сопоставляется адрес кошелька. При поступлении средств на счет биржи с адреса пользователя сумма автоматически зачисляетсмя на счети этого пользователя, при выводе - выполняется соответствующий перевод с кошелька биржи на кошелек пользователя. При движении средств внутри биржи (оплата проектов) этии изменения прописываются в базе данных, но реальных переводов не происходит до вывода средств пользователем на свой кошелек. 



### Конфигурирование сервиса фриланс-биржи
Сервис должен поддерживать конфигурирование следующими методами:

адрес и порт запуска сервиса: переменная окружения ОС RUN_ADDRESS или флаг -a;

адрес подключения к базе данных: переменная окружения ОС DATABASE_URI или флаг -d;

адрес rpc-узла для отслеживания ввода и вывода: переменная окружения ОС RPC_NODE_URL или флаг -r.


